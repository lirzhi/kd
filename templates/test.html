<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Element-UI Example</title>
    <!-- 引入Element-UI的样式文件 -->
    <link rel="stylesheet" href="./element-ui.css">
    <link rel="stylesheet" href="./test.css">
</head>
<body>
    <div id="app">
        <!-- 整体容器 -->
        <el-container class="main-wrapper">
            <!-- 头部区域 -->
            <el-header class="system-header">
                <span class="system-title">审评系统</span>
            </el-header>

            <el-container class="content-wrapper">
                <!-- 侧边导航栏 -->
                <el-aside width="200px" class="nav-sidebar">
                    <el-menu
                        default-active="1"
                        class="menu-container"
                        @select="handleMenuSelect">
                        <el-menu-item index="1">
                            <i class="el-icon-document"></i>
                            <span>报告生成</span>
                        </el-menu-item>
                        <el-menu-item index="2">
                            <i class="el-icon-files"></i>
                            <span>审批记录</span>
                        </el-menu-item>
                        <el-menu-item index="3">
                            <i class="el-icon-files"></i>
                            <span>eCTD管理</span>
                        </el-menu-item>
                    </el-menu>
                </el-aside>

                <!-- 主内容区域 -->
                <el-main class="main-content">
                    <!-- 章节选择栏 -->
                    <div class="chapter-selector">
                        <el-select
                            v-model="selectedChapterIndex"
                            placeholder="请选择章节"
                            class="chapter-select">
                            <el-option
                                v-for="(chapter, index) in chapters"
                                :key="index"
                                :label="'第' + chapter.label + '章'"
                                :value="index">
                            </el-option>
                        </el-select>
                    </div>

                    <!-- 双栏内容区域 -->
                    <el-row  class="card-container" :gutter="20">
                        <!-- 左侧内容卡片 --> 
                        <el-col v-if="!isSourceView" :span="12">
                            <el-card class="content-card">
                                <div class="text-editor-container">
                                    <el-input
                                        type="textarea"
                                        v-model="content"
                                        :rows="35"
                                        placeholder="输入章节内容"
                                        class="rounded-editor">
                                    </el-input>
                                </div>
                            </el-card>
                        </el-col>

                        <!-- 左侧内容卡片 -->
                        <el-col v-else :span="12">
                            <el-card class="content-card">
                            <!-- 搜索栏 -->
                                <div class="source-search">
                                    <el-input
                                    v-model="sourceSearchQuery"
                                    placeholder="搜索结论来源"
                                    @keyup.enter.native="searchSources"
                                    clearable>
                                    <el-button
                                        slot="append"
                                        icon="el-icon-search"
                                        @click="searchSources">
                                    </el-button>
                                    </el-input>
                                </div>

                                <!-- 来源列表 -->
                                <div class="source-list">
                                    <el-card
                                    v-for="(source, index) in filteredSources"
                                    :key="index"
                                    class="source-item">
                                    <div class="source-header">
                                        <span class="source-title">来源 {{ index + 1 }}</span>
                                        <el-button
                                        type="danger"
                                        icon="el-icon-delete"
                                        circle
                                        @click="deleteSource(index)">
                                        </el-button>
                                    </div>

                                    <div class="source-content">
                                        <el-input
                                        type="textarea"
                                        :value="source.requirement"
                                        :rows="3"
                                        readonly
                                        class="requirement-box">
                                        </el-input>
                                        <el-input
                                        type="textarea"
                                        v-model="source.conclusion"
                                        :rows="4"
                                        readonly
                                        class="conclusion-box">
                                        </el-input>
                                    </div>
                                    </el-card>
                                </div>
                            </el-card>
                        </el-col>

                        <!-- 右侧结论卡片 -->
                        <el-col :span="12">
                            <el-card class="conclusion-card">
                                <div slot="header" class="report-header">
                                    <span>审评报告</span>
                                    <div>
                                        <el-button
                                            type="primary"
                                            @click="generateReport(selectedChapterIndex)"
                                            style="margin-left: 10px;">
                                            生成报告
                                        </el-button>
                                        <el-button type="info" @click="showSource">结论来源</el-button>
                                        <el-button type="warning" @click="showExpDialog">经验管理</el-button>
                                        <el-button type="danger" @click="regenerate">重新生成</el-button>
                                    </div>
                                </div>

                                 <!-- 新增动态生成区域
                                <transition name="el-zoom-in-top">
                                    <div v-if="isGenerating" class="stream-display">
                                        <el-input
                                            type="textarea"
                                            :value="streamContent"
                                            :rows="8"
                                            readonly
                                            class="dynamic-console"
                                            id="streamConsole">
                                        </el-input>
                                    </div>
                                </transition> -->

                                <!-- 最终报告显示 -->
                                <!-- <div class="conclusion-display" :style="{marginTop: isGenerating ? '20px' : '0'}"> -->
                                <div class="conclusion-display" >
                                    <el-input
                                        type="textarea"
                                        :value="displayReport"
                                        :rows="29"
                                        readonly
                                        class="rounded-display"
                                        id="finalReport">
                                    </el-input>
                                </div>

                                <div  class="stream-display" :style="{marginTop:  '20px' }">
                                    <el-input
                                        type="textarea"
                                        :value="streamContent"
                                        :rows="2"
                                        readonly
                                        class="dynamic-console"
                                        id="streamConsole">
                                    </el-input>
                                </div>
                            </el-card>
                        </el-col>
                    </el-row>
                </el-main>
            </el-container>
        </el-container>

        <!-- 经验管理对话框 -->
        <el-dialog
            title="经验管理"
            :visible.sync="expDialogVisible"
            width="66%"
            top="5vh"
            :center="true"
            custom-class="exp-dialog">
            <div class="exp-dialog-content">
                <!-- 输入区域 -->
                <div class="input-section">
                    <el-input
                        v-model="newExperience"
                        type="textarea"
                        :rows="3"
                        resize="vertical"
                        placeholder="输入新经验"
                        class="exp-textarea">
                    </el-input>
                    <div class="btn-container">
                        <el-button
                            type="primary"
                            class="confirm-btn"
                            @click="addExperience">
                            添加经验
                        </el-button>
                    </div>
                </div>

                <!-- 经验列表 -->
                <div class="exp-list">
                    <el-card
                        v-for="(exp, index) in experiences"
                        :key="index"
                        class="exp-item">
                        <div class="card-content">
                            <el-input
                                v-model="exp.content"
                                type="textarea"
                                resize="vertical"
                                :autosize="{ minRows: 2 }"
                                class="exp-content">
                            </el-input>
                            <div class="action-container">
                                <el-button
                                    type="danger"
                                    icon="el-icon-delete"
                                    circle
                                    @click="deleteExperience(index)">
                                </el-button>
                            </div>
                        </div>
                    </el-card>
                </div>
            </div>
        </el-dialog>
        <el-dialog
            title="eCTD管理"
            :visible.sync="uploadDialogVisible"
            width="60%">
            <!-- @opened="fetchECTDList"> -->
            <!-- 文件上传区域 -->
            <div class="upload-section">
                <el-upload
                    class="upload-demo"
                    ref="upload"
                    action="http://127.0.0.1:5000/upload"
                    :on-preview="handlePreview"
                    :on-remove="handleRemove"
                    :file-list="fileList"
                    :auto-upload="false">
                    <el-button slot="trigger" size="small" type="primary">选取文件</el-button>
                    <el-button style="margin-left: 10px;" size="small" type="success" @click="submitUpload">上传到服务器</el-button>
                    <el-form ref="form" :model="uploadForm" label-width="80px">
                        <el-form-item label="类别">
                          <el-input v-model="uploadForm.classification"></el-input>
                       </el-form-item>
                       <el-form-item label="影响范围">
                        <el-input v-model="uploadForm.affect_range"></el-input>
                     </el-form-item>
                     </el-form>

                    <div slot="tip" class="el-upload__tip">只能上传eCTD文件</div>
                </el-upload>
            </div>

            <!-- eCTD列表 -->
            <el-table
                :data="ectdList"
                style="width: 100%"
                border
                >
                <el-table-column
                prop="doc_id"
                label="文档ID"
                width="180">
                </el-table-column>
                <el-table-column
                prop="file_name"
                label="文件名称">
                </el-table-column>
                </template>
                </el-table-column>
            </el-table>
        </el-dialog>
       
    </div>
    <!-- 引入Vue.js -->
    <script src="./vue.js"></script>
    <!-- 引入Element-UI -->
    <script src="./element-ui.js"></script>
    <script src="./test.js"></script>
</body>
</html>